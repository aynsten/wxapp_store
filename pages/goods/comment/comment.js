const App = getApp(); Page({ data: { swiperHeight: 0, options: { goods_id: null, scoreType: -1 }, list: [], page: 1, notcont: false }, onLoad: function (options) { let _this = this; this.setSwiperHeight(); _this.setData({ 'options.goods_id': options.goods_id }, function () { _this.getCommentList() }) }, setSwiperHeight: function () { let systemInfo = wx.getSystemInfoSync(), rpx = systemInfo.windowWidth / 750, tapHeight = Math.floor(rpx * 80) + 1, swiperHeight = systemInfo.windowHeight - tapHeight; this.setData({ swiperHeight }) }, getCommentList: function (isNextPage, page) { let _this = this; let params = _this.data.options; params.page = page || 1; App._get('comment/lists', params, function (result) { let resultList = result.data.list, dataList = _this.data.list; if (isNextPage !== true || typeof dataList.data === 'undefined') { _this.setData({ list: resultList, total: result.data.total, notcont: !resultList.length }) } else { _this.setData({ 'list.data': dataList.data.concat(resultList.data), total: result.data.total }) } }) }, swichNav: function (e) { let _this = this; _this.setData({ list: {}, page: 1, no_more: false, 'options.scoreType': e.target.dataset.current }, function () { _this.getCommentList() }) }, previewImages: function (e) { let commentIndex = e.target.dataset.commentIndex, imgIndex = e.target.dataset.imgIndex, images = this.data.list.data[commentIndex].image, imageUrls = []; images.forEach(function (item) { imageUrls.push(item.file_path) }); wx.previewImage({ current: imageUrls[imgIndex], urls: imageUrls }) }, bindDownLoad: function () { if (this.data.page >= this.data.list.last_page) { this.setData({ no_more: true }); return false } this.getCommentList(true, ++this.data.page) }, })