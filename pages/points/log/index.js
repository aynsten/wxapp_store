const App = getApp(); Page({ data: { list: [], isLoading: true, page: 1, }, onLoad(options) { let _this = this; _this.setListHeight() }, onShow() { let _this = this; _this.getPointsLog() }, getPointsLog(isPage, page) { let _this = this; App._get('points.log/index', { page: page || 1 }, result => { let resList = result.data.list, dataList = _this.data.list; if (isPage == true) { _this.setData({ 'list.data': dataList.data.concat(resList.data), isLoading: false, }) } else { _this.setData({ list: resList, isLoading: false, }) } }) }, setListHeight() { let _this = this, systemInfo = wx.getSystemInfoSync(); _this.setData({ scrollHeight: systemInfo.windowHeight * 0.98 }) }, onPageDown() { let _this = this; if (_this.data.page >= _this.data.list.last_page) { _this.setData({ no_more: true }); return false } _this.getPointsLog(true, ++_this.data.page) }, })