let App = getApp(); Page({ data: { disabled: false, nav_select: false, region: '', detail: {}, error: '', }, onLoad: function (options) { this.getAddressDetail(options.address_id) }, getAddressDetail: function (address_id) { let _this = this; App._get('address/detail', { address_id }, function (result) { _this.setData(result.data) }) }, saveData: function (e) { let _this = this, values = e.detail.value; values.region = this.data.region; App.saveFormId(e.detail.formId); if (!_this.validation(values)) { App.showError(_this.data.error); return false } _this.setData({ disabled: true }); values.address_id = _this.data.detail.address_id; App._post_form('address/edit', values, function (result) { App.showSuccess(result.msg, function () { wx.navigateBack() }) }, false, function () { _this.setData({ disabled: false }) }) }, validation: function (values) { if (values.name === '') { this.data.error = '收件人不能为空'; return false } if (values.phone.length < 1) { this.data.error = '手机号不能为空'; return false } let reg = /^((0\d{2,3}-\d{7,8})|(1[3456789]\d{9}))$/; if (!reg.test(values.phone)) { this.data.error = '手机号不符合要求'; return false } if (!this.data.region) { this.data.error = '省市区不能空'; return false } if (values.detail === '') { this.data.error = '详细地址不能为空'; return false } return true }, bindRegionChange: function (e) { this.setData({ region: e.detail.value }) }, chooseAddress: function () { let _this = this; wx.chooseAddress({ success: function (res) { _this.setData({ 'detail.name': res.userName, 'detail.phone': res.telNumber, 'detail.detail': res.detailInfo, region: [res.provinceName, res.cityName, res.countyName], }) } }) }, })