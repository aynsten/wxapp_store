const App = getApp(); Page({ data: { page: {}, items: {}, }, onLoad: function (options) { let _this = this; _this.data.page_id = options.page_id; _this.getPageData() }, getPageData: function (callback) { let _this = this; App._get('page/index', { page_id: _this.data.page_id }, function (result) { _this.setPageBar(result.data.page); _this.setData(result.data); typeof callback === 'function' && callback() }) }, setPageBar: function (page) { wx.setNavigationBarTitle({ title: page.params.title }); wx.setNavigationBarColor({ frontColor: page.style.titleTextColor === 'white' ? '#ffffff' : '#000000', backgroundColor: page.style.titleBackgroundColor }) }, onShareAppMessage: function () { let _this = this; let params = App.getShareUrlParams({ 'page_id': _this.data.page_id }); return { title: _this.data.page.params.share_title, path: "/pages/custom/index?" + params } }, onPullDownRefresh: function () { this.getPageData(function () { wx.stopPullDownRefresh() }) } });