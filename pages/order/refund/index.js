const App = getApp(); Page({ data: { applyStatus: [], isLoading: true, dataType: -1, page: 1, no_more: false, }, onLoad: function (options) { this.setSwiperHeight() }, onShow: function () { this.getRefundList() }, getRefundList: function (isNextPage, page) { let _this = this; App._get('user.refund/lists', { state: _this.data.dataType, page: page || 1, }, function (result) { _this.setData(_this.createData(result.data, isNextPage)) }) }, createData: function (data, isNextPage) { data['isLoading'] = false; let dataList = this.data.list; if (isNextPage == true && (typeof dataList !== 'undefined')) { data.list.data = dataList.data.concat(data.list.data) } data['tabList'] = [{ value: -1, text: '全部' }, { value: 0, text: '待处理' }]; return data }, setSwiperHeight: function () { let systemInfo = wx.getSystemInfoSync(), rpx = systemInfo.windowWidth / 750, tapHeight = Math.floor(rpx * 82), swiperHeight = systemInfo.windowHeight - tapHeight; this.setData({ swiperHeight }) }, swichNav: function (e) { let _this = this, current = e.target.dataset.current; if (_this.data.dataType == current) { return false } _this.setData({ dataType: current, list: {}, page: 1, no_more: false, isLoading: true, }, function () { _this.getRefundList() }) }, triggerDownLoad: function () { if (this.data.page >= this.data.list.last_page) { this.setData({ no_more: true }); return false } this.getRefundList(true, ++this.data.page) }, triggerDetail: function (e) { wx.navigateTo({ url: './detail/detail?order_refund_id=' + e.currentTarget.dataset.id }) }, })