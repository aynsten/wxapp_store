const App = getApp(); const Dialog = require('../../../components/dialog/dialog'); Page({ data: { is_read: false, disabled: false, }, onLoad: function (options) { }, onShow: function () { this.getApplyState() }, getApplyState: function () { let _this = this; App._get('user.dealer/apply', { referee_id: _this.getRefereeid() }, function (result) { let data = result.data; if (data.is_dealer) { wx.redirectTo({ url: '../index/index' }) } wx.setNavigationBarTitle({ title: data.words.apply.title.value }); data.isData = true; _this.setData(data) }) }, toggleApplyLicense: function () { Dialog({ title: '申请协议', message: this.data.license, selector: '#zan-base-dialog', isScroll: true, buttons: [{ text: '我已阅读', color: 'red', type: 'cash' }] }).then(() => { }) }, toggleSetRead: function () { this.setData({ is_read: !this.data.is_read }) }, formSubmit: function (e) { let _this = this, values = e.detail.value; App.saveFormId(e.detail.formId); if (!values.name || values.name.length < 1) { App.showError('请填写姓名'); return false } if (!/^\+?\d[\d -]{8,12}\d/.test(values.mobile)) { App.showError('手机号格式不正确'); return false } if (!_this.data.is_read) { App.showError('请先阅读分销商申请协议'); return false } _this.setData({ disabled: true }); App._post_form('user.dealer.apply/submit', values, function () { _this.getApplyState() }, null, function () { _this.setData({ disabled: false }) }) }, navigationToIndex: function (e) { App.saveFormId(e.detail.formId); wx.switchTab({ url: '/pages/index/index', }) }, getRefereeid: function () { return wx.getStorageSync('referee_id') }, })