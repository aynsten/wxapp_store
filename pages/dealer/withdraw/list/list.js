const App = getApp(); Page({ data: { applyStatus: [], isLoading: true, dataType: -1, page: 1, no_more: false, }, onLoad: function (options) { this.setSwiperHeight() }, onShow: function () { this.getWithdrawList() }, getWithdrawList: function (isNextPage, page) { let _this = this; App._get('user.dealer.withdraw/lists', { status: _this.data.dataType, page: page || 1, }, function (result) { _this.setData(_this.createData(result.data, isNextPage)) }) }, createData: function (data, isNextPage) { data['isLoading'] = false; let dataList = this.data.list; if (isNextPage == true && (typeof dataList !== 'undefined')) { data.list.data = dataList.data.concat(data.list.data) } wx.setNavigationBarTitle({ title: data.words.withdraw_list.title.value });data['tabList'] = [{ value: -1, text: data.words.withdraw_list.words.all.value, }, { value: 10, text: data.words.withdraw_list.words.apply_10.value, }, { value: 20, text: data.words.withdraw_list.words.apply_20.value, }, { value: 40, text: data.words.withdraw_list.words.apply_40.value, }, { value: 30, text: data.words.withdraw_list.words.apply_30.value, }]; data['applyStatus'] = {}; data['tabList'].forEach(function (item) { data['applyStatus'][item.value] = item.text }); return data }, setSwiperHeight: function () { let systemInfo = wx.getSystemInfoSync(), rpx = systemInfo.windowWidth / 750, tapHeight = Math.floor(rpx * 82), swiperHeight = systemInfo.windowHeight - tapHeight; this.setData({ swiperHeight }) }, swichNav: function (e) { let _this = this, current = e.target.dataset.current; if (_this.data.dataType == current) { return false } _this.setData({ dataType: current, list: {}, page: 1, no_more: false, isLoading: true, }, function () { _this.getWithdrawList() }) }, triggerDownLoad: function () { if (this.data.page >= this.data.list.last_page) { this.setData({ no_more: true }); return false } this.getWithdrawList(true, ++this.data.page) }, triggerReasonMsg: function (e) { wx.showModal({ title: '友情提示', content: e.currentTarget.dataset.reason, showCancel: false }) }, })