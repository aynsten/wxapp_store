const App = getApp(); Page({ data: { isLoading: true, dataType: -1, page: 1, no_more: false, user_grade_id: 0, }, onLoad: function (options) { this.setSwiperHeight() }, onShow: function () { this.getOrderList() }, getOrderList: function (isNextPage, page) { let _this = this; App._get('user.dealer.order/lists', { settled: _this.data.dataType, page: page || 1, }, function (result) { _this.setData(_this.createData(result.data, isNextPage)) }) }, createData: function (data, isNextPage) { data['isLoading'] = false; let dataList = this.data.list; if (isNextPage == true && (typeof dataList !== 'undefined')) { data.list.data = dataList.data.concat(data.list.data) } wx.setNavigationBarTitle({ title: data.words.order.title.value }); data['user_id'] = App.getUserId(); this.getUserGrade(); data['tabList'] = [{ value: -1, text: data.words.order.words.all.value, }, { value: 0, text: data.words.order.words.unsettled.value, }, { value: 1, text: data.words.order.words.settled.value, }]; return data }, getUserGrade() { let _this = this; App._get('user.index/detail', {}, function (result) { _this.setData({ user_grade_id: result.data.userInfo.grade_id, }) }) }, setSwiperHeight: function () { let systemInfo = wx.getSystemInfoSync(), rpx = systemInfo.windowWidth / 750, tapHeight = Math.floor(rpx * 82), swiperHeight = systemInfo.windowHeight - tapHeight; this.setData({ swiperHeight }) }, swichNav: function (e) { let _this = this; _this.setData({ dataType: e.target.dataset.current, list: {}, page: 1, no_more: false, isLoading: true, }, function () { _this.getOrderList() }) }, triggerDownLoad: function () { if (this.data.page >= this.data.list.last_page) { this.setData({ no_more: true }); return false } this.getOrderList(true, ++this.data.page) }, })