const App = getApp(); Page({ data: { isLoading: true, dataType: 1, page: 1, no_more: false, }, onLoad: function (options) { }, onShow: function () { this.getTeamList() }, getTeamList: function (isNextPage, page) { let _this = this; App._get('user.dealer.team/lists', { level: _this.data.dataType, page: page || 1, }, function (result) { _this.setData(_this.createData(result.data, isNextPage)) }) }, createData: function (data, isNextPage) { data['isLoading'] = false; let dataList = this.data.list; if (isNextPage == true && (typeof dataList !== 'undefined')) { data.list.data = dataList.data.concat(data.list.data) } wx.setNavigationBarTitle({ title: data.words.team.title.value }); data['team_total'] = data.dealer.first_num; data['tabList'] = [{ value: 1, text: data.words.team.words.first.value, total: data.dealer.first_num }]; if (data.setting.level >= 2) { data['tabList'].push({ value: 2, text: data.words.team.words.second.value, total: data.dealer.second_num }); data['team_total'] += data.dealer.second_num } if (data.setting.level == 3) { data['tabList'].push({ value: 3, text: data.words.team.words.third.value, total: data.dealer.third_num }); data['team_total'] += data.dealer.third_num } this.setSwiperHeight(data.setting.level > 1); return data }, triggerDownLoad: function () { if (this.data.page >= this.data.list.last_page) { this.setData({ no_more: true }); return false } this.getTeamList(true, ++this.data.page) }, setSwiperHeight: function (isTap) { let systemInfo = wx.getSystemInfoSync(), rpx = systemInfo.windowWidth / 750, tapHeight = isTap ? Math.floor(rpx * 82) : 0, peopleHeight = Math.floor(rpx * 65), swiperHeight = systemInfo.windowHeight - tapHeight - peopleHeight; this.setData({ swiperHeight }) }, swichNav: function (e) { let _this = this; _this.setData({ dataType: e.target.dataset.current, list: {}, page: 1, no_more: false, isLoading: true, }, function () { _this.getTeamList() }) }, })